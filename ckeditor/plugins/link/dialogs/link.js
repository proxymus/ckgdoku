var update_ckgdokuInternalLink,update_ckgdokuMediaLink;var fckgInternalInputId,fckgMediaInputId,ckgdokuIwikiData,ckgdokuIwikiIndex;var ck_m_files_protocol,ckg_dialog,linkOpt;window.onbeforeunload=function(){};CKEDITOR.dialog.add("link",function(d){oDokuWiki_FCKEditorInstance.Lang=d.lang;ck_m_files_protocol=oDokuWiki_FCKEditorInstance.mfiles?["m-files://\u200E","m-files://"]:"";var B=oDokuWiki_FCKEditorInstance.dwiki_doku_base;var X=CKEDITOR.plugins.link;var k=new Object();k.doku_base=new RegExp("^"+B.replace(/\//g,"\\/"),"g");k.media_internal=/lib\/exe\/fetch\.php\/(.*)/;k.media_rewrite_1=/^_media\/(.*)/;k.media_rewrite_1Doku_Base=new RegExp("^"+B+"_media/(.*)");k.media_rewrite_2=/exe\/fetch.php\?media=(.*)/;k.internal_link=/doku.php\?id=(.*)/;k.internal_link_rewrite_2=/doku.php\/(.*)/;k.internal_link_rewrite_1=new RegExp("^"+B+"(?!_media)(.*)");k.samba=/file:\/\/\/\/\/(.*)/;k.interwiki=/^(.*?)oIWIKIo(.*?)cIWIKIc/;k.samba_unsaved=/^\\\\\w+(\\\w.*)/;ckg_dialog=CKEDITOR.dialog;var H;var N={InternalLink:"internal link",LinkText:"Link Text (Optional)",InternalMedia:"internal media",MediaFileLink:"link to media file",SMBLabel:"Samba Share",GetHeadingsLabel:"Get Headings",QStringLabel:"Query String (For example: value_1=1&value_2=2) ",ResetQS:"Reset Query String",NotSetOption:"Not Set",AdvancedInfo:"To create anchors from Dokuwiki headers, click on the Get Headings button, select the header, click OK. You can go back, select a new page and get new headers.",AdvancedTabPrompt:"Use the advanced tab to create page anchors and query strings",SMBExample:"Enter your share as: \\\\Server\\directory\\file",InterWikiLink:"Interwiki Link",InterWikiType:"Interwiki Type",InterwikiPlaceHolder:"Interwiki Replacement Text",InterwikiInfo:"<div style='max-width:350px; white-space: pre-wrap;border:1px solid #cccccc; margin:auto; overflow:auto; padding:4px;line-height:125%;'>Dokuwiki's interwiki links are short-cuts which look like this: <span style='font-weight:600'>[[wp&gt;Shakespeare]]</span>, which will create a link to the English Wikipedia article on Shakespeare.  The <span style='font-weight:600'>wp</span> part designates a link pattern;  the text following the '<span style='font-weight:900'>&gt;</span>' will be inserted into the link, replacing  a place holder, which is enclosed in curly brackets, as in <span style='font-weight:600'>{NAME}</span>. When there is no place holder, the replacement text will be appended to the end of the link.</div>",MediaFileLink:"link to media file"};var v=d.lang.fbrowser?d.lang.fbrowser:N;var n=function(aa){if(v[aa]&&v[aa]!=""){return v[aa]}return N[aa]};jQuery.ajax(DOKU_BASE+"lib/exe/ajax.php",{data:{call:"iwiki_list"},type:"POST",async:true,dataType:"json",success:function(ab,ac,aa){retv=ab;ckgdokuIwikiData=retv},error:function(aa,ac,ab){alert(ac);alert(ab)}});var W=function(){var ad=this.getDialog();var af=ad.getContentElement("advanced","internalAnchor").getInputElement().$.id;var aa=document.getElementById(af);var ac=ad.getContentElement("info","internal").getInputElement().$.id;ac=document.getElementById(ac).value;if(!ac){return}var ab={push:function(ah,ag){this.stack[this.Index]=(new Option(ah,ag,false,false));this.Index++},Index:0,stack:undefined,selection:"",ini:function(ag){this.stack=aa.options;this.stack.length=0;this.Index=0;this.push(ag,"")}};var ae="dw_id="+ac;d.config.jquery.post(d.config.ckedit_path+"get_headers.php",ae,function(ak,ag){if(ag=="success"){var al=decodeURIComponent(ak);if(al.match(/^\s*__EMPTY__\s*$/)){ab.ini("No Headers Found");ab.selection="";return}ab.ini("Headings Menu");var aj=al.split("@@");for(var ai in aj){var ah=aj[ai].split(/;;/);ab.push(ah[0],ah[1])}}},"html")};var G=function(){doku_linkwiz.init(jQuery("#dw__editform"),d);doku_linkwiz.val="global";doku_linkwiz.toggle()};var Q=function(ab){var ac=ab;var aa=0;var ad="dw_id="+encodeURIComponent(ab);d.config.jquery.ajax({url:d.config.ckedit_path+"useheading.php",async:true,data:ad,type:"POST",dataType:"html",success:function(ae){if(aa){alert(ae)}ac=decodeURIComponent(ae)},error:function(ae,ag,af){ac=ab}});return ac};var Y=function(){return H};var t;var q=function(){oDokuWiki_FCKEditorInstance.isLocalDwikiBrowser=false;oDokuWiki_FCKEditorInstance.isUrlExtern=false;oDokuWiki_FCKEditorInstance.isDwikiMediaFile=false;var ad=this.getDialog(),ag=["urlOptions","anchorOptions","emailOptions","internalOptions","mediaOptions","sambaOptions","interwikiOptions"],af=this.getValue(),ae=ad.definition.getContents("upload"),aa=ae&&ae.hidden;ad.hidePage("advanced");if(af=="internal"){oDokuWiki_FCKEditorInstance.isLocalDwikiBrowser=true;ad.showPage("advanced")}else{if(af=="media"){oDokuWiki_FCKEditorInstance.isDwikiMediaFile=true}}if(af=="url"){oDokuWiki_FCKEditorInstance.isUrlExtern=true;if(!aa){ad.showPage("upload")}}else{if(!aa){ad.hidePage("upload")}}for(var ac=0;ac<ag.length;ac++){var ab=ad.getContentElement("info",ag[ac]);if(!ab){continue}ab=ab.getElement().getParent().getParent();if(ag[ac]==af+"Options"){ab.show()}else{ab.hide()}}ad.layout()};var P=/^javascript:/,S=/^mailto:([^?]+)(?:\?(.+))?$/,m=/subject=([^;?:@&=$,\/]*)/,Z=/body=([^;?:@&=$,\/]*)/,y=/^#(.*)$/,f=/^((?:http|https|ftp|news|m-files):\/\/)?(.*)$/,z=/^(_(?:self|top|parent|blank))$/,s=/^javascript:void\(location\.href='mailto:'\+String\.fromCharCode\(([^)]+)\)(?:\+'(.*)')?\)$/,M=/^javascript:([^(]+)\(([^)]+)\)$/;var u=B.replace("/","/")+"doku.php?id=(.*)$";var c="/"+u+"/";var p=/\s*window.open\(\s*this\.href\s*,\s*(?:'([^']*)'|null)\s*,\s*'([^']*)'\s*\)\s*;\s*return\s*false;*\s*/;var E=/(?:^|,)([^=]+)=(\d+|yes|no)/gi;var r=function(ad,aa){var au=(aa&&(aa.data("cke-saved-href")||aa.getAttribute("href")))||"",ah,at,ap,ai,ak={};if((ah=au.match(P))){if(o=="encode"){au=au.replace(s,function(ay,aA,az){return"mailto:"+String.fromCharCode.apply(String,aA.split(","))+(az&&x(az))})}else{if(o){au.replace(M,function(aE,aG,aB){if(aG==O.name){ak.type="email";var aF=ak.email={};var az=/[^,\s]+/g,aA=/(^')|('$)/g,ay=aB.match(az),aH=ay.length,aD,aI;for(var aC=0;aC<aH;aC++){aI=decodeURIComponent(x(ay[aC].replace(aA,"")));aD=O.params[aC].toLowerCase();aF[aD]=aI}aF.address=[aF.name,aF.domain].join("@")}})}}}if(!ak.type){var aq=aa?aa.getAttribute("class"):"";if((ap=au.match(y))){ak.type="anchor";ak.anchor={};ak.anchor.name=ak.anchor.id=ap[1]}else{if((at=au.match(S))){var aj=au.match(m),al=au.match(Z);ak.type="email";var an=(ak.email={});an.address=at[1];aj&&(an.subject=decodeURIComponent(aj[1]));al&&(an.body=decodeURIComponent(al[1]))}else{if((ai=au.match(k.media_internal))||(ai=au.match(k.media_rewrite_1))||(ai=au.match(k.media_rewrite_2))||(ai=au.match(k.media_rewrite_1Doku_Base))){ak.type="media";ak.url={};ak.url.protocol="";ak.url.url="";ak.url.selected=ai[1]}else{if((ai=au.match(c))||(ai=au.match(k.internal_link_rewrite_2))||(ai=au.match(k.internal_link_rewrite_1))){ak.type="internal";ak.url={};var ac=ai[1].split("=");ak.url.selected=ac[1];ak.url.protocol="";ak.url.url=""}else{if(ai=au.match(k.samba)){ak.type="samba";ak.url={};ak.url.url="";ak.url.protocol="";ak.url.selected="\\\\"+ai[1].replace(/\//g,"\\")}else{if(ai=au.match(k.samba_unsaved)){ak.type="samba";ak.url={};ak.url.url="";ak.url.protocol="";ak.url.selected=ai[0]}else{if(ai=au.match(k.interwiki)||aq.match(/interwiki/)){var ao="";if(ai&&ai[2]){ao=decodeURIComponent(ai[2])}ak.url={};t=aa.getAttribute("class");var ag=ckg_dialog.getContentElement("info","iwiki_shortcut");var av=ag.getInputElement().$.id;var am=document.getElementById(av);var af=t.match(/iw_([^\s]+)/);var ae=af[1].replace(/_/,".");if(!ao){var ar=ckgdokuIwikiData[ae];ar=ar.replace(/\{\w+\}$/,"");var ab=new RegExp(ar+"(.*)");af=au.match(ab);ao=af[1]}ae=ckgdokuIwikiIndex[ae];if(ae){am.selectedIndex=ae}else{am.selectedIndex="0"}ag.disable();ak.type="interwiki";ak.url.selected=ao;ak.url.url=ao}else{if(au&&(ai=au.match(f))){ak.type="url";ak.url={};ak.url.protocol=ai[1];ak.url.url=ai[2]}else{ak.type="url"}}}}}}}}}if(aa){var ax=aa.getAttribute("target");ak.target={};ak.adv={};var aw=this}this._.selectedElement=aa;return ak};var e;var I=function(ab){if(!ab){return}document.getElementById(fckgInternalInputId).disabled=true;document.getElementById(fckgInternalInputId).style.fontWeight="bold";document.getElementById(fckgInternalInputId).style.backgroundColor="#DDDDDD";ab=ab.replace(/^[\/\:]/,"");ab=ab.replace(/\//g,":");ab=":"+ab;document.getElementById(fckgInternalInputId).value=ab;e=C(ab,top);ckg_dialog.getContentElement("info","relative_link").disable();var aa=ckg_dialog.getContentElement("info","relative_link").getInputElement().$.id};update_ckgdokuInternalLink=I;var a=function(aa){return aa.replace(/^\s+|\s+$/g,"")};var b=function(aa){aa=a(aa);if(!aa||typeof(aa)=="undefined"){return true}};var C=function(af,ag){ag=top.JSINFO.id;var ac=af.split(":");var ae=ac.length;if(ae<2||a(ac[0])){return af}var ad=ag.split(":");if(b(ac[0])){ad.unshift("")}nPage=ad.length;var ab=1;var aa=(ae<nPage?ae:nPage)-1;for(i=1;i<aa;++i){if(a(ac[i])===a(ad[i])){++ab}else{break}}if(ab==1){return af}aPageDiff=ad.slice(ab);nPageDiff=aPageDiff.length;aLinkDiff=ac.slice(ab);var ah=new Array();if(nPageDiff>1){ah=new Array(nPageDiff-1);ah=ah.fill("..")}else{if(nPageDiff==1){ah[0]="."}}ah=ah.concat(aLinkDiff);return ah.join(":")};var g=function(aa){if(!aa){return}aa=aa.replace(/^[\/\:]/,"");aa=aa.replace(/\//g,":");aa=":"+aa;document.getElementById(fckgMediaInputId).value=aa};update_ckgdokuMediaLink=g;var w=function(aa){for(i in aa){msg=i+"="+aa[i];if(!confirm(msg)){break}}};var D=function(ab,aa){if(aa[ab]){this.setValue(aa[ab][this.id]||"")}};var T=function(aa){return D.call(this,"target",aa)};var R=function(aa){return D.call(this,"adv",aa)};var V=function(ab,aa){if(!aa[ab]){aa[ab]={}}aa[ab][this.id]=this.getValue()||""};var F=function(aa){return V.call(this,"target",aa)};var U=function(aa){return V.call(this,"adv",aa)};function x(aa){return aa.replace(/\\'/g,"'")}function J(aa){return aa.replace(/'/g,"\\$&")}var o=d.config.emailProtection||"";if(o&&o!="encode"){var O={};o.replace(/^([^(]+)\(([^)]+)\)$/,function(aa,ab,ac){O.name=ab;O.params=[];ac.replace(/[^,\s]+/g,function(ad){O.params.push(ad)})})}function j(ac){var aa,ab=O.name,ag=O.params,ae,af;aa=[ab,"("];for(var ad=0;ad<ag.length;ad++){ae=ag[ad].toLowerCase();af=ac[ae];ad>0&&aa.push(",");aa.push("'",af?J(encodeURIComponent(ac[ae])):"","'")}aa.push(")");return aa.join("")}function A(ab){var aa,ae=ab.length,ac=[];for(var ad=0;ad<ae;ad++){aa=ab.charCodeAt(ad);ac.push(aa)}return"String.fromCharCode("+ac.join(",")+")"}function L(ab){var aa=ab.getAttribute("class");return aa?aa.replace(/\s*(?:cke_anchor_empty|cke_anchor)(?:\s*$)?/g,""):""}var K=d.lang.common,l=d.lang.link;linkOpt={};var h=CKEDITOR.instances.wiki__text.config.filebrowserBrowseUrl;if(h.indexOf("fckeditor")===-1){linkOpt={type:"button",id:"browse1",label:K.browseServer,onClick:G}}else{linkOpt={type:"button",id:"browse1",label:K.browseServer,filebrowser:"info:url"}}return{title:l.title,minWidth:375,minHeight:250,contents:[{id:"info",label:l.info,title:l.info,elements:[{id:"linkType",type:"select",label:l.type,"default":"url",items:[[l.toUrl,"url"],[n("InternalLink"),"internal"],[n("InternalMedia"),"media"],[l.toEmail,"email"],[n("SMBLabel"),"samba"],[n("InterWikiLink"),"interwiki"]],onChange:q,setup:function(aa){if(aa.type){this.setValue(aa.type)}},commit:function(aa){aa.type=this.getValue()}},{type:"vbox",id:"urlOptions",children:[{type:"hbox",widths:["25%","75%"],children:[{id:"protocol",type:"select",label:K.protocol,"default":"http://",items:[["http://\u200E","http://"],["https://\u200E","https://"],["ftp://\u200E","ftp://"],["news://\u200E","news://"],ck_m_files_protocol],setup:function(aa){if(aa.url){this.setValue(aa.url.protocol||"")}},commit:function(aa){if(!aa.url){aa.url={}}aa.url.protocol=this.getValue()}},{type:"text",id:"url",label:K.url,required:true,onLoad:function(){this.allowOnChange=true},onKeyUp:function(){this.allowOnChange=false;var ac=this.getDialog().getContentElement("info","protocol"),aa=this.getValue(),ab=/^(http|https|ftp|news|m-files):\/\/(?=.)/i,ae=/^((javascript:)|[#\/\.\?])/i;var ad=ab.exec(aa);if(ad){this.setValue(aa.substr(ad[0].length));ac.setValue(ad[0].toLowerCase())}else{if(ae.test(aa)){ac.setValue("")}}this.allowOnChange=true},onChange:function(){if(this.allowOnChange){this.onKeyUp()}},validate:function(){var aa=this.getDialog();if(aa.getContentElement("info","linkType")&&aa.getValueOf("info","linkType")!="url"){return true}if(this.getDialog().fakeObj){return true}var ab=CKEDITOR.dialog.validate.notEmpty(l.noUrl);return ab.apply(this)},setup:function(aa){this.allowOnChange=false;if(aa.url){this.setValue(aa.url.url)}this.allowOnChange=true},commit:function(aa){this.onChange();if(!aa.url){aa.url={}}aa.url.url=this.getValue();this.allowOnChange=false}}],setup:function(aa){if(!this.getDialog().getContentElement("info","linkType")){this.getElement().show()}}}]},{type:"vbox",id:"internalOptions",children:[linkOpt,{type:"text",id:"internal",label:n("InternalLink"),required:true,setup:function(aa){if(aa){if(aa.url&&aa.url.selected){var ab=aa.url.selected.replace(/^\:/,"");this.setValue(":"+ab)}}}},{type:"text",id:"internal_text",label:n("LinkText"),required:false},{id:"relative_link",label:"Create a relative link",type:"checkbox","default":false},{id:"anchorsmsg",type:"html",html:n("AdvancedTabPrompt")}]},{type:"vbox",id:"interwikiOptions",children:[{type:"text",id:"interwiki",label:n("InterwikiPlaceHolder"),required:true,setup:function(aa){if(aa){if(aa.url&&aa.url.selected){var ab=aa.url.selected.replace(/^\:/,"");this.setValue(ab)}}},commit:function(aa){if(!aa.url){aa.url={}}aa.url.selection=this.getValue()}},{id:"iwiki_shortcut",type:"select",label:n("InterWikiType"),"default":"",items:[["Not Set","Not-Set"]],setup:function(aa){if(aa.url){this.setValue(aa.url.iwiki_shortcut||"")}},commit:function(aa){if(!aa.url){aa.url={}}aa.url.iwiki_shortcut=this.getValue()}},{id:"iwikimsg",type:"html",html:n("InterwikiInfo")}]},{type:"vbox",id:"mediaOptions",children:[{type:"button",id:"browse2",filebrowser:"info:media",label:K.browseServer},{type:"text",id:"media",label:n("MediaFileLink"),required:true,setup:function(aa){if(aa){if(aa.url&&aa.url.selected){var ab=aa.url.selected.replace(/^\:/,"");this.setValue(":"+ab)}}}}]},{type:"vbox",id:"sambaOptions",children:[{type:"html",id:"smb_msg",html:n("SMBExample")},{type:"text",id:"samba",width:"50",label:n("SMBLabel"),required:true,setup:function(aa){if(aa.url&&aa.url.selected){this.setValue(aa.url.selected)}}}]},{type:"vbox",id:"emailOptions",padding:1,children:[{type:"text",id:"emailAddress",label:l.emailAddress,required:true,validate:function(){var aa=this.getDialog();if(!aa.getContentElement("info","linkType")||aa.getValueOf("info","linkType")!="email"){return true}var ab=CKEDITOR.dialog.validate.notEmpty(l.noEmail);return ab.apply(this)},setup:function(ab){if(ab.email){this.setValue(ab.email.address)}var aa=this.getDialog().getContentElement("info","linkType");if(aa&&aa.getValue()=="email"){this.select()}},commit:function(aa){if(!aa.email){aa.email={}}aa.email.address=this.getValue()}},{type:"text",id:"emailSubject",label:l.emailSubject,setup:function(aa){if(aa.email){this.setValue(aa.email.subject)}},commit:function(aa){if(!aa.email){aa.email={}}aa.email.subject=this.getValue()}},{type:"textarea",id:"emailBody",label:l.emailBody,rows:3,"default":"",setup:function(aa){if(aa.email){this.setValue(aa.email.body)}},commit:function(aa){if(!aa.email){aa.email={}}aa.email.body=this.getValue()}}],setup:function(aa){if(!this.getDialog().getContentElement("info","linkType")){this.getElement().hide()}}}]},{id:"upload",label:l.upload,title:l.upload,hidden:true,filebrowser:"uploadButton",elements:[{type:"file",id:"upload",label:K.upload,style:"height:40px",size:29},{type:"fileButton",id:"uploadButton",label:K.uploadSubmit,filebrowser:"info:url","for":["upload","upload"]}]},{id:"advanced",label:l.advanced,title:l.advanced,elements:[{id:"msg",type:"html",html:"<p style='max-width:350px; white-space: pre-wrap;'>"+n("AdvancedInfo")+"</p>"},{id:"internalAnchor",type:"select","default":"",items:[["Not Set",""]],setup:function(aa){if(aa.hash){this.setValue(aa.hash)}},commit:function(aa){aa.hash=this.getValue()}},{type:"button",id:"getheaders",onClick:W,label:n("GetHeadingsLabel")},{type:"html",html:"<br />"},{type:"text",id:"queryString",label:n("QStringLabel"),setup:function(aa){if(aa.qstring){this.setValue(aa.qstring)}},commit:function(aa){aa.qstring=this.getValue()}},{type:"button",id:"clearquerystring",onClick:function(){var ab=this.getDialog();var ac=ab.getContentElement("advanced","queryString").getInputElement().$.id;var aa=document.getElementById(ac);aa.value=""},label:n("ResetQS")},{type:"vbox",padding:1,hidden:true,children:[{type:"hbox",widths:["45%","55%"],children:[{type:"text",label:l.cssClasses,"default":"",id:"advCSSClasses",setup:R,commit:U},{type:"text",label:l.charset,"default":"",id:"advCharset",setup:R,commit:U}]}]}]}],onShow:function(){var ac=this.getParentEditor(),ab=ac.getSelection(),aa=null;if((aa=X.getSelectedLink(ac))&&aa.hasAttribute("href")){ab.selectElement(aa)}else{aa=null}this.setupContent(r.apply(this,[ac,aa]))},onOk:function(){var aD=false;var ap=false;var ak=new RegExp(oDokuWiki_FCKEditorInstance.imageUploadAllowedExtensions);var am={},af=[],aG={},aF=this,ah=this.getParentEditor();this.commitContent(aG);var az=false;var an="";switch(aG.type||"url"){case"media":if(document.getElementById(fckgMediaInputId).value){aG.url.url=document.getElementById(fckgMediaInputId).value}aG.adv.advTitle=aG.url.url;var aE=aG.url.url.match(/(\.(\w+))$/);an=aG.url.url.replace(/^:/,"");aG.url.url=top.dokuBase+"doku.php?id="+aG.url.url;if(aE[1].match(ak)){aG.adv.advContentType="linkonly"}else{aG.adv.advContentType="other_mime";aG.url.url=top.dokuBase+"lib/exe/fetch.php?media="+an;az=true}aG.adv.advCSSClasses="media mediafile";if(aE){aG.adv.advCSSClasses+=" mf_"+aE[2]}var au=(aG.url&&aG.url.protocol!=undefined)?aG.url.protocol:"http://",ai=(aG.url&&CKEDITOR.tools.trim(aG.url.url))||"";am["data-cke-saved-href"]=(ai.indexOf("/")===0)?ai:au+ai;break;case"internal":aD=this.getValueOf("info","internal_text");ap=this.getValueOf("info","relative_link");if(ap&&e){aG.url.url=e}if(!aG.url.url){aG.url.url=document.getElementById(fckgInternalInputId).value;if(!aG.url.url.match(/^:\w+/)&&!aG.url.url.match(/^\.?/)){var aI=top.getCurrentWikiNS()+":";aI=aI.replace(/:$/,"");var ae=new RegExp(":?"+aI+":");if(!aG.url.url.match(ae)){aG.url.url=aI+":"+aG.url.url;aG.url.url=aG.url.url.replace(/\:{2,}/g,":")}}}aG.url.url=aG.url.url.replace(/^.*?\/data\/pages\//,"");aG.url.url=aG.url.url.replace(/^\:/,"");if(!aG.url.url.match(/^\./)){aG.url.url=":"+aG.url.url.replace(/\//g,":")}aG.adv.advCSSClasses="wikilink1";if(oDokuWiki_FCKEditorInstance.useheading=="y"){aG.adv.advTitle=Q(aG.url.url)}else{aG.adv.advTitle=aG.url.url}aG.url.url=top.dokuBase+"doku.php?id="+aG.url.url;if(aG.hash){aG.url.url+="#"+aG.hash}if(aG.qstring){aG.url.url+="&"+aG.qstring}var au=(aG.url&&aG.url.protocol!=undefined)?aG.url.protocol:"http://",ai=(aG.url&&CKEDITOR.tools.trim(aG.url.url))||"";am["data-cke-saved-href"]=(ai.indexOf("/")===0)?ai:au+ai;break;case"interwiki":if(t){aG.adv.advCSSClasses=t}else{aG.adv.advCSSClasses="interwiki iw_"+aG.url.iwiki_shortcut}var aA=ckgdokuIwikiData[aG.url.iwiki_shortcut];aG.adv.advTitle=aG.url.selection;if(aG.url.selection){aG.url.selection="oIWIKIo"+aG.url.selection+"cIWIKIc"}if(aA.match(/\{.*?\}/)){aG.url.url=ckgdokuIwikiData[aG.url.iwiki_shortcut].replace(/{.*?}/,aG.url.selection)}else{aG.url.url=aA+aG.url.selection}am["data-cke-saved-href"]=aG.url.url;break;case"url":var au=(aG.url&&aG.url.protocol!=undefined)?aG.url.protocol:"http://",ai=(aG.url&&CKEDITOR.tools.trim(aG.url.url))||"";am["data-cke-saved-href"]=(ai.indexOf("/")===0)?ai:au+ai;break;case"anchor":var aJ=(aG.anchor&&aG.anchor.name),av=(aG.anchor&&aG.anchor.id);am["data-cke-saved-href"]="#"+(aJ||av||"");break;case"samba":if(!aG.url.url){aG.url.url=document.getElementById(Y()).value}if(!aG.url.url){alert("Missing Samba Url");return false}aG.url.protocol="";var au="";ai=(aG.url&&CKEDITOR.tools.trim(aG.url.url))||"";am["data-cke-saved-href"]=(ai.indexOf("/")===0)?ai:au+ai;aG.adv.advCSSClasses="windows";aG.adv.advTitle=aG.url.url;break;case"email":var ad,ax=aG.email,ag=ax.address;switch(o){case"":case"encode":var aj=encodeURIComponent(ax.subject||""),ao=encodeURIComponent(ax.body||"");var al=[];ao&&al.push("body="+ao);aj&&al.push("subject="+aj);al=al.length?"?"+al.join("&"):"";if(o=="encode"){ad=["javascript:void(location.href='mailto:'+",A(ag)];al&&ad.push("+'",J(al),"'");ad.push(")")}else{ad=["mailto:",ag,al]}break;default:var aw=ag.split("@",2);ax.name=aw[0];ax.domain=aw[1];ad=["javascript:",j(ax)]}am["data-cke-saved-href"]=ad.join("");break}if(aG.adv){var ay=function(aK,aL){var aM=aG.adv[aK];if(aM){am[aL]=aM}else{af.push(aL)}};ay("advId","id");ay("advLangDir","dir");ay("advAccessKey","accessKey");if(aG.adv.advName){am.name=am["data-cke-saved-name"]=aG.adv.advName}else{af=af.concat(["data-cke-saved-name","name"])}ay("advLangCode","lang");ay("advTabIndex","tabindex");if(!az){ay("advTitle","title")}ay("advContentType","type");ay("advCSSClasses","class");ay("advCharset","charset");ay("advStyles","style");ay("advRel","rel")}var aH=ah.getSelection();var at=aH.getSelectedText()?aH.getSelectedText():false;am.href=am["data-cke-saved-href"];if(!this._.selectedElement){var ac=aH.getRanges(true);if(ac.length==1&&ac[0].collapsed){var ar=new CKEDITOR.dom.text(aG.type=="email"?aG.email.address:am["data-cke-saved-href"],ah.document);ac[0].insertNode(ar);ac[0].selectNodeContents(ar);aH.selectRanges(ac)}if(navigator.userAgent.match(/(Trident|MSIE)/)){var aa=ah.document.createElement("a");aa.setAttribute("href",am.href);if(!at&&(aG.type=="media"||aG.type=="internal")){if(aD){aa.setHtml(aD)}else{aa.setHtml(aG.adv.advTitle)}}else{aa.setHtml(aH.getSelectedText())}for(attr in am){if(attr.match(/href/i)){continue}aa.setAttribute(attr,am[attr])}ah.insertElement(aa)}else{var aC=new CKEDITOR.style({element:"a",attributes:am});aC.type=CKEDITOR.STYLE_INLINE;aC.apply(ah.document)}}else{var ab=this._.selectedElement,aB=ab.data("cke-saved-href"),aq=ab.getHtml();if(az){am.type="other_mime";am.title=":"+an}ab.setAttributes(am);ab.removeAttributes(af);if(aG.adv&&aG.adv.advName&&CKEDITOR.plugins.link.synAnchorSelector){ab.addClass(ab.getChildCount()?"cke_anchor":"cke_anchor_empty")}if(aB==aq||aG.type=="email"&&aq.indexOf("@")!=-1){ab.setHtml(aG.type=="email"?aG.email.address:am["data-cke-saved-href"])}aH.selectElement(ab);delete this._.selectedElement}if(aD){ar.setText(aD)}else{if(ar&&aG.adv.advTitle){ar.setText(aG.adv.advTitle)}}},onLoad:function(){ckg_iwi_Select_Id_x=this.getContentElement("info","iwiki_shortcut").getInputElement().$.id;var ac=function(){if(!ckgdokuIwikiData){return}ag();var ah=document.getElementById(ckg_iwi_Select_Id_x);this.stack=ah.options;this.stack.length=0;this.stack[0]=(new Option("Not Set","not-set",false,false));ckgeditIwikiIndex=new Array();var aj=1;for(var ai in ckgdokuIwikiData){this.stack[aj]=new Option(ai+" >> "+ckgdokuIwikiData[ai],ai,false,false);ckgeditIwikiIndex[ai]=aj;aj++}};var ab=setInterval(function(){ac()},1000);var ag=function(){clearInterval(ab)};oDokuWiki_FCKEditorInstance.isDwikiImage=false;fckgInternalInputId=this.getContentElement("info","internal").getInputElement().$.id;fckgMediaInputId=this.getContentElement("info","media").getInputElement().$.id;H=this.getContentElement("info","samba").getInputElement().$.id;var ae=this.getContentElement("info","iwiki_shortcut").getInputElement().$.id;this.getContentElement("info","media").disable();this.hidePage("advanced");this.showPage("info");ckg_dialog=this;var ad=this._.tabs.advanced&&this._.tabs.advanced[0];var aa=this;var af=n("NotSetOption");ad.on("focus",function(ai){var aj=aa.getContentElement("advanced","internalAnchor").getInputElement().$.id;var ah=document.getElementById(aj);ah.selectedIndex=-1;ah.options.length=0;ah.options[0]=new Option(af,"",false,false)});CKEDITOR.config.LinkAb2sRel=C},onFocus:function(){var aa=this.getContentElement("info","linkType"),ab;if(aa&&aa.getValue()=="url"){ab=this.getContentElement("info","url");ab.select()}}}});var doku_linkwiz={$wiz:null,$entry:null,result:null,timer:null,textArea:null,selected:null,$ck:null,init:function(b,a){var c=b.position();$ck=a;if(doku_linkwiz.$wiz){return}doku_linkwiz.$wiz=jQuery(document.createElement("div")).dialog({autoOpen:false,draggable:true,title:LANG.linkwiz,resizable:false}).html("<div>"+LANG.linkto+' <input type="text" class="edit" id="link__wiz_entry" autocomplete="off" /></div><div id="link__wiz_result"></div>').parent().attr("id","link__wiz").css({position:"absolute",top:(c.top+20)+"px",left:(c.left+80)+"px","z-index":"20000"}).hide().appendTo(".dokuwiki:first");doku_linkwiz.textArea=b[0];doku_linkwiz.result=jQuery("#link__wiz_result")[0];jQuery(doku_linkwiz.result).css("position","relative");doku_linkwiz.$entry=jQuery("#link__wiz_entry");if(JSINFO.namespace){doku_linkwiz.$entry.val(JSINFO.namespace+":")}jQuery("#link__wiz .ui-dialog-titlebar-close").click(doku_linkwiz.hide);doku_linkwiz.$entry.keyup(doku_linkwiz.onEntry);jQuery(doku_linkwiz.result).delegate("a","click",doku_linkwiz.onResultClick)},onEntry:function(a){if(a.keyCode==37||a.keyCode==39){return true}if(a.keyCode==27){doku_linkwiz.hide();a.preventDefault();a.stopPropagation();return false}if(a.keyCode==38){doku_linkwiz.select(doku_linkwiz.selected-1);a.preventDefault();a.stopPropagation();return false}if(a.keyCode==40){doku_linkwiz.select(doku_linkwiz.selected+1);a.preventDefault();a.stopPropagation();return false}if(a.keyCode==13){if(doku_linkwiz.selected>-1){var b=doku_linkwiz.$getResult(doku_linkwiz.selected);if(b.length>0){doku_linkwiz.resultClick(b.find("a")[0])}}else{if(doku_linkwiz.$entry.val()){doku_linkwiz.insertLink(doku_linkwiz.$entry.val())}}a.preventDefault();a.stopPropagation();return false}doku_linkwiz.autocomplete()},getResult:function(a){DEPRECATED("use doku_linkwiz.$getResult()[0] instead");return doku_linkwiz.$getResult()[0]||null},$getResult:function(a){return jQuery(doku_linkwiz.result).find("div").eq(a)},select:function(b){if(b<0){doku_linkwiz.deselect();return}var d=doku_linkwiz.$getResult(b);if(d.length===0){return}doku_linkwiz.deselect();d.addClass("selected");var a=d.position().top;var c=a+d.outerHeight()-jQuery(doku_linkwiz.result).innerHeight();if(a<0){jQuery(doku_linkwiz.result)[0].scrollTop+=a}else{if(c>0){jQuery(doku_linkwiz.result)[0].scrollTop+=c}}doku_linkwiz.selected=b},deselect:function(){if(doku_linkwiz.selected>-1){doku_linkwiz.$getResult(doku_linkwiz.selected).removeClass("selected")}doku_linkwiz.selected=-1},onResultClick:function(a){if(!jQuery(this).is("a")){return}a.stopPropagation();a.preventDefault();doku_linkwiz.resultClick(this);return false},resultClick:function(b){doku_linkwiz.$entry.val(b.title);if(b.title==""||b.title.substr(b.title.length-1)==":"){doku_linkwiz.autocomplete_exec()}else{if(jQuery(b.nextSibling).is("span")){doku_linkwiz.insertLink(b.nextSibling.innerHTML)}else{doku_linkwiz.insertLink("")}}},insertLink:function(g){var d=doku_linkwiz.$entry.val(),a,b,f,e;if(!d){return}d=":"+d.replace(/^:/,"");var c=CKEDITOR.dialog.getCurrent();a=CKEDITOR.config.LinkAb2sRel(d);alert(a);b=c.getValueOf("info","relative_link");if(b){if(a){d=a}}c.getContentElement("info","internal").setValue(d);doku_linkwiz.hide();doku_linkwiz.$entry.val(doku_linkwiz.$entry.val().replace(/[^:]*$/,""))},autocomplete:function(){if(doku_linkwiz.timer!==null){window.clearTimeout(doku_linkwiz.timer);doku_linkwiz.timer=null}doku_linkwiz.timer=window.setTimeout(doku_linkwiz.autocomplete_exec,350)},autocomplete_exec:function(){var a=jQuery(doku_linkwiz.result);doku_linkwiz.deselect();a.html('<img src="'+DOKU_BASE+'lib/images/throbber.gif" alt="" width="16" height="16" />').load(DOKU_BASE+"lib/exe/ajax.php",{call:"linkwiz",q:doku_linkwiz.$entry.val()})},show:function(){doku_linkwiz.$wiz.show();doku_linkwiz.$entry.focus();doku_linkwiz.autocomplete();var a=doku_linkwiz.$entry.val();doku_linkwiz.$entry.val("");doku_linkwiz.$entry.val(a)},hide:function(){doku_linkwiz.$wiz.hide();doku_linkwiz.textArea.focus()},toggle:function(){if(doku_linkwiz.$wiz.css("display")=="none"){doku_linkwiz.show()}else{doku_linkwiz.hide()}}};